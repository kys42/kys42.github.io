<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데일리 리포트 - 김경덕님</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
        }
        .text-gradient-sodium {
            background: linear-gradient(to right, #f87171, #fb923c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-200">
    <div class="max-w-md mx-auto bg-slate-900 min-h-screen pb-16">
        <!-- Header -->
        <header class="p-6 bg-slate-900 text-white">
            <p class="text-lg text-gray-400">2025년 4월 23일</p>
            <h1 class="text-3xl font-bold mt-1">김경덕님을 위한 데일리 리포트</h1>
        </header>

        <main class="p-6 space-y-8">
            
            <!-- 1. 한줄요약 -->
            <section class="p-6 bg-slate-800 rounded-2xl shadow-lg border border-slate-700">
                <h2 class="text-xl font-bold text-gray-100 mb-3 flex items-center"><span class="text-2xl mr-2">📝</span> 한줄요약</h2>
                <div class="mt-4 bg-slate-700 p-4 rounded-lg">
                    <p class="text-md text-gray-200">엄청난 운동량으로 혈당을 방어하고 있지만, 나트륨과 정제 탄수화물 위주의 식단으로 인해 혈당 스파이크가 자주 발생하며 장기적인 건강 위험이 높습니다.</p>
                </div>
            </section>

            <!-- 2. 각 리포트 결과 -->
            <section class="p-6 bg-slate-800 rounded-2xl shadow-lg border border-slate-700">
                <h2 class="text-xl font-bold text-gray-100 mb-4">각 리포트 결과 🔬</h2>
                
                <div class="space-y-8">
                    <!-- 2.1 혈당 리포트 -->
                    <div>
                        <h3 class="font-bold text-gray-100 mb-3">🩸 혈당 리포트</h3>
                        <p class="text-sm text-gray-400 mb-4">김경덕님의 혈당 데이터는 현재의 좋은 습관과 위험한 습관을 동시에 보여주는 중요한 지표입니다.</p>
                        
                        <!-- 혈당 라인 그래프 추가 -->
                        <div class="relative h-48 mb-6">
                            <canvas id="glucoseLineChart"></canvas>
                        </div>

                        <div class="relative h-48 w-48 mx-auto mb-4">
                            <canvas id="tirChart"></canvas>
                        </div>
                        <div class="text-sm mt-3 bg-slate-700 p-4 rounded-lg space-y-2">
                            <p>• <span class="font-semibold text-gray-100">평균 혈당:</span> 137.6 mg/dL (변동성 12.3%로 안정적)</p>
                            <p>• <span class="font-semibold text-gray-100">목표 혈당 범위(TIR):</span> 66%</p>
                            <p>• <span class="font-semibold text-orange-400">고혈당(140 초과) 시간:</span> 34% (하루의 1/3)</p>
                            <p>• <span class="font-semibold text-red-500">최고 혈당(스파이크):</span> 191 mg/dL</p>
                            <p>• <span class="font-semibold text-green-400">저혈당:</span> 발생하지 않음</p>
                        </div>
                    </div>

                    <!-- 2.2 식단 리포트 -->
                    <div>
                        <h3 class="font-bold text-gray-100 mb-3">🍽️ 식단 리포트</h3>
                        <p class="text-sm text-gray-400 mb-4">혈당 스파이크의 원인은 식단에 있었습니다. 특히 점심 식사가 가장 큰 문제였습니다.</p>
                        <div class="text-center mb-4 bg-slate-700 p-4 rounded-lg">
                            <p class="text-gray-400">오늘의 나트륨 섭취량</p>
                            <p class="text-5xl font-bold text-gradient-sodium mt-1">5878.1 mg</p>
                            <p class="text-sm text-gray-400 mt-1">(권장량 2000mg의 <span class="font-bold text-red-400">294%</span>)</p>
                        </div>
                        <div class="text-sm text-gray-200 bg-slate-700 p-4 rounded-lg space-y-3">
                           <p><strong class="text-orange-400">[점심]</strong> 물냉면, 돼지불고기, 백미밥 등 한 끼에 1566 kcal, 나트륨 4184.6mg을 섭취하여 폭발적인 수치를 기록했습니다.</p>
                           <p><strong class="text-yellow-400">[저녁]</strong> 양념치킨과 와인 역시 나트륨(1038.5mg)과 불필요한 칼로리를 더했습니다.</p>
                           <p><strong class="text-blue-400">[아침/간식]</strong> 모닝롤, 감자칩 등 단백질과 식이섬유가 부족한 선택이었습니다.</p>
                           <p class="pt-2 border-t border-slate-600 mt-2">총 섭취 열량은 2697 kcal로 활동량을 고려해도 다소 높습니다.</p>
                        </div>
                    </div>

                    <!-- 2.3 운동 리포트 -->
                    <div>
                        <h3 class="font-bold text-gray-100 mb-3">💪 운동 리포트</h3>
                        <p class="text-sm text-gray-400 mb-4">김경덕님의 가장 큰 강점은 운동입니다. 운동이 현재 혈당을 지탱하는 핵심 기둥입니다.</p>
                        <div class="bg-slate-700 rounded-lg p-4 text-center mb-4">
                            <p class="text-gray-400">'스포츠 애호가'의 총 소모 칼로리</p>
                            <p class="text-5xl font-bold text-teal-400 mt-1">1400+<span class="text-2xl font-normal">kcal</span></p>
                        </div>
                        <div class="bg-slate-700 rounded-lg p-4">
                             <div class="grid grid-cols-3 gap-4 text-center">
                                <div>
                                    <p class="text-3xl">🏊‍♂️</p>
                                    <p class="font-bold text-sm mt-1">수영</p>
                                    <p class="text-xs text-gray-400">1시간 / 500kcal</p>
                                </div>
                                <div>
                                    <p class="text-3xl">⛳</p>
                                    <p class="font-bold text-sm mt-1">스크린 골프</p>
                                    <p class="text-xs text-gray-400">2시간 / 600kcal</p>
                                </div>
                                <div>
                                    <p class="text-3xl">🚴</p>
                                    <p class="font-bold text-sm mt-1">자전거</p>
                                    <p class="text-xs text-gray-400">30분 / 300kcal</p>
                                </div>
                             </div>
                        </div>
                        <div class="text-sm text-gray-200 mt-4 bg-slate-700 p-3 rounded-lg">
                           <p>현재 운동은 칼로리를 태우는 유산소와 기술 연마에 집중되어 있습니다. 근육의 크기와 힘을 직접적으로 키워 기초대사량을 높이는 <strong class="text-teal-400">저항 운동(웨이트 트레이닝)이 부족</strong>한 상태입니다.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. 초개인화된 권장사항 -->
            <section class="p-6 bg-slate-800 rounded-2xl shadow-lg border border-slate-700">
                <h2 class="text-xl font-bold text-gray-100 mb-4">초개인화된 권장사항 🎯</h2>
                <p class="text-sm text-gray-400 mb-4">'최고의 창(운동)'과 '최악의 방패(식단)'를 동시에 가진 상황입니다. 식단을 개선하고 운동 전략을 수정하면 건강한 신체를 만들 수 있습니다.</p>
                <div class="space-y-4">
                    
                    <div class="p-4 bg-slate-700 rounded-lg space-y-3">
                        <p class="font-bold text-blue-400">1. (최우선) 혈당 스파이크의 주범, '나트륨과 정제 탄수화물'부터 잡으세요.</p>
                        <div class="text-sm text-gray-200 border-l-4 border-slate-600 pl-4 space-y-2">
                            <p>• <strong class="text-teal-400">점심 메뉴 재구성:</strong> 물냉면과 밥 중 하나만 선택하고 양은 절반으로 줄이세요. (국물 섭취 금지)</p>
                            <p>• <strong class="text-teal-400">국물/소스 제한:</strong> 국/찌개는 건더기만, 소스는 최소한으로 섭취하세요.</p>
                            <p>• <strong class="text-teal-400">건강한 단백질 선택:</strong> 양념고기 대신 구운 닭가슴살, 수육, 생선구이, 두부를 선택하세요.</p>
                            <p>• <strong class="text-teal-400">아침 식사 보강:</strong> 모닝롤 대신 계란 프라이 2개나 그릭요거트를 추가하세요.</p>
                        </div>
                    </div>

                    <div class="p-4 bg-slate-700 rounded-lg space-y-3">
                        <p class="font-bold text-blue-400">2. 훌륭한 운동 습관에 '근력 운동'을 더해 효율을 높이세요.</p>
                         <div class="text-sm text-gray-200 border-l-4 border-slate-600 pl-4 space-y-2">
                            <p>• <strong class="text-teal-400">주 2회, '근육 만드는 날' 추가:</strong> 40분씩 스쿼트, 푸쉬업, 덤벨 로우 같은 전신 근력 운동을 해보세요.</p>
                            <p>• <strong class="text-teal-400">운동 목적 분리:</strong> 유산소(심폐능력), 골프(기술), 근력운동(몸 만들기)으로 목적을 명확히 하세요.</p>
                            <p>• <strong class="text-teal-400">부상 방지:</strong> 근력 운동은 신체 불균형을 보완하여 부상 위험을 줄여줍니다.</p>
                        </div>
                    </div>

                    <div class="p-4 bg-slate-700 rounded-lg space-y-3">
                         <p class="font-bold text-blue-400">3. 운동과 식사의 시너지를 극대화하세요.</p>
                         <div class="text-sm text-gray-200 border-l-4 border-slate-600 pl-4 space-y-2">
                            <p>• <strong class="text-teal-400">운동 후 회복식 변경:</strong> 양념고기 대신 삶은 달걀, 두부, 단백질 쉐이크 등으로 근육 회복을 도와주세요.</p>
                            <p>• <strong class="text-teal-400">건강한 간식으로 교체:</strong> 감자칩 대신 방울토마토, 오이, 무가당 요거트, 견과류를 선택하세요.</p>
                         </div>
                    </div>

                </div>
            </section>
        </main>
    </div>

    <script>
        // Globally register the datalabels plugin and set default chart colors
        Chart.register(ChartDataLabels);
        Chart.defaults.color = '#E0E0E0';
        Chart.defaults.font.family = "'Noto Sans KR', sans-serif";

        // --- Data Initialization ---
        const tirData = { inRange: 66, high: 34, low: 0 };
        // CSV data is embedded here for portability
        const csvData = `"측정차수","측정기간","센서활성","장치","일련번호","소스장치","기록 구분","측정 및 기록 시간","혈당 값 (mg/dL)","[식사] 음식명","[식사] 유형","[식사] 음주여부","[식사] 칼로리 (kcal)","[식사] 탄수화물 (g)","[식사] 당류 (g)","[식사] 단백질 (g)","[식사] 지방 (g)","[식사] 포화지방 (g)","[식사] 트랜스지방 (g)","[식사] 콜레스테롤 (mg)","[식사] 나트륨 (mg)","[운동] 종류","[운동] 기타 메모","[운동] 시간","[운동] 소모칼로리 (kcal)","[인슐린] 종류","[인슐린] 제품명","[인슐린] 투여량","[복약] 약 종류","[복약] 메모","메모"
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 00:04:07","122","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 00:09:07","123","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 00:14:08","122","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 00:19:07","123","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 00:24:07","129","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 00:29:07","131","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 00:34:07","128","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 00:39:07","118","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 00:44:08","114","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 00:49:07","121","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 08:34:07","135","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 08:39:08","134","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","식사","2025.04.23 08:41:00","","아메리카노","아침","X","10","2","0","1","0","0","0","0","5","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","식사","2025.04.23 08:41:00","","밀도 모닝롤 180g","아침","X","86","12.9","3.6","2.4","2.7","1.1","0","21","66","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 08:44:08","134","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 08:49:08","131","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 08:54:08","130","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 08:59:08","137","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 09:04:09","151","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 12:29:09","135","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","식사","2025.04.23 12:34:00","","물냉면 / 돼지불고기 / 백미밥 / 김치전 / 쌈장 / 초고추장 / 배추김치 / 깻잎","점심","X","1566","226.9","43.5","60.8","45.2","11.9","0.3","210.2","4184.6","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 12:34:09","137","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 12:39:09","135","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 13:24:08","189","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 13:29:09","191","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 13:34:09","188","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 16:14:09","143","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 16:19:08","141","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","식사","2025.04.23 16:51:00","","감자칩","간식","X","190","17.6","0.2","1.9","12","1.9","0","469","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 16:54:09","141","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 16:59:09","142","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","식사","2025.04.23 20:08:00","","백미밥 / 미역국","저녁","X","276","55.2","1.3","8.9","1.2","0.3","0","10.2","469.2","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 20:09:09","129","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","식사","2025.04.23 20:14:00","","양념치킨","저녁","X","356","34.2","1","18.4","16.2","3.6","0","49","562","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","식사","2025.04.23 20:14:00","","수박","저녁","X","47","11.8","7.6","1.2","0.1","0","0","0","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 20:14:09","131","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","식사","2025.04.23 20:16:00","","화이트와인","저녁","O","121","3.8","1.4","0.1","0","0","0","0","7.3","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 20:19:09","138","","","","","","","","","","","","","","","","","","","","","",""
"1","2025.04.13 - 2025.04.24","100%","G7","839512974258","iOS","혈당","2025.04.23 23:59:07","121","","","","","","","","","","","","","","","","","","","","","",""`;

        // --- DOM Manipulation & Chart Initialization ---
        document.addEventListener('DOMContentLoaded', () => {

            // --- Data Parsing ---
            const glucoseData = { labels: [], values: [] };
            const rows = csvData.split('\n').slice(1); // Split into rows and skip header
            rows.forEach(row => {
                const columns = row.split(',').map(field => field.replace(/"/g, '')); // Split columns and remove quotes
                const recordType = columns[6];
                const timestamp = columns[7];
                const glucoseValue = parseInt(columns[8], 10);

                if (recordType === '혈당' && timestamp && !isNaN(glucoseValue)) {
                    // Extract HH:MM from the timestamp
                    const time = timestamp.split(' ')[1].substring(0, 5);
                    glucoseData.labels.push(time);
                    glucoseData.values.push(glucoseValue);
                }
            });

            // --- Chart Initialization ---

            // 1. Glucose Line Chart
            const ctxLine = document.getElementById('glucoseLineChart').getContext('2d');
            new Chart(ctxLine, {
                type: 'line',
                data: {
                    labels: glucoseData.labels,
                    datasets: [{
                        label: '혈당 (mg/dL)',
                        data: glucoseData.values,
                        fill: false,
                        borderWidth: 2.5,
                        pointRadius: 0,
                        tension: 0.4,
                        // Segment styling: color lines based on value
                        segment: {
                            borderColor: ctx => {
                                const y = ctx.p1.parsed.y;
                                if (y > 180) return 'rgba(239, 68, 68, 0.8)'; // Red for high-risk
                                if (y > 140) return 'rgba(249, 115, 22, 0.8)'; // Orange for warning
                                return 'rgba(34, 197, 94, 0.8)'; // Green for in-range
                            }
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        datalabels: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: {
                                // Show fewer labels to avoid clutter
                                callback: function(value, index, values) {
                                    const label = this.getLabelForValue(value);
                                    // Show a label every 2 hours (approx)
                                    if (index % 24 === 0) {
                                        return label.substring(0, 2) + '시';
                                    }
                                    return '';
                                }
                            }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            suggestedMin: 50,
                            suggestedMax: 220,
                            title: {
                                display: true,
                                text: 'mg/dL'
                            }
                        }
                    }
                }
            });


            // 2. TIR Chart (Doughnut)
            const ctxDoughnut = document.getElementById('tirChart').getContext('2d');
            new Chart(ctxDoughnut, {
                type: 'doughnut',
                data: {
                    labels: ['목표 범위 내', '고혈당', '저혈당'],
                    datasets: [{
                        data: [tirData.inRange, tirData.high, tirData.low],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)', // Green
                            'rgba(249, 115, 22, 0.8)', // Orange
                            'rgba(59, 130, 246, 0.8)' // Blue
                        ],
                        borderColor: '#1e293b', // bg-slate-800
                        borderWidth: 4,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                boxWidth: 12
                            }
                        },
                        datalabels: {
                            formatter: (value, ctx) => {
                                if (value === 0) return '';
                                let sum = 0;
                                let dataArr = ctx.chart.data.datasets[0].data;
                                dataArr.map(data => {
                                    sum += data;
                                });
                                let percentage = (value * 100 / sum).toFixed(0) + "%";
                                return percentage;
                            },
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 14
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
